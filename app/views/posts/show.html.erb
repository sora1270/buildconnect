<div class="container mt-5">
  <div class="row">
    <!-- 投稿者のプロフィール情報 -->
    <div class="col-md-4">
      <div class="card">
        <div class="card-body">
          <h3 class="card-title">投稿者のプロフィール</h3>
          <p><strong>名前:</strong> <%= link_to @post.user.full_name, user_path(@post.user) %></p>
          <p><strong>会社名:</strong> <%= @post.user.company_name %></p>
        </div>
      </div>
    </div>

    <!-- 投稿の詳細情報 -->
    <div class="col-md-8">
      <h1 class="text-center mb-4"><%= @post.title %></h1>

      <div class="card">
        <div class="card-body">
          <h4 class="card-title">詳細</h4>
          <ul class="list-unstyled">
            <li><strong>募集業種:</strong> <%= @post.genres.map(&:name).join(', ') %></li>
            <li><strong>期間:</strong> <%= @post.duration %></li>
            <li><strong>場所:</strong> <%= @post.location %></li>
            <li><strong>募集人数:</strong> <%= @post.recruit_status %></li>
            <li>
              <strong>応募締切:</strong>
              <% if @post.application_deadline.present? %>
                <%= @post.application_deadline.strftime("%Y-%m-%d") %> (残り <%= @post.days_remaining %> 日)
              <% else %>
                <em>未定</em>
              <% end %>
            </li>
            <li><strong>概要:</strong> <%= @post.content %></li>
          </ul>
        </div>
      </div>

      <% if @post.user == current_user %>
        <div class="d-flex justify-content-start mt-4">
          <%= link_to "編集", edit_post_path(@post), class: "btn btn-secondary me-2" %>
          <%= button_to "削除", post_path(@post), method: :delete, class: "btn btn-danger", data: { confirm: "本当に削除しますか？" } %>
        </div>
        <div class="mt-4">
          <h4>募集人数の管理</h4>
          <%= form_with(model: @post, local: true, url: update_recruit_status_post_path(@post), method: :patch) do |form| %>
            <div class="mb-3">
              <%= form.label :current_recruits, '現在の募集人数', class: 'form-label' %>
              <%= form.number_field :current_recruits, class: 'form-control', value: @post.current_recruits, min: 0 %>
            </div>
            <%= form.submit '更新', class: 'btn btn-primary' %>
          <% end %>
        </div>
      <% end %>

      <!-- コメント一覧 -->
      <div class="comments mt-4">
        <h3>コメント</h3>
        <% @post.comments.each do |comment| %>
          <div class="card mb-2">
            <div class="card-body">
              <div class="d-flex align-items-center mb-2">
                <%= image_tag comment.user.get_profile_image, size: '50x50', class: 'img-thumbnail me-2' %>
                <p class="mb-0"><strong><%= link_to comment.user.full_name, user_path(comment.user) %></strong></p>
              </div>
              <p><%= comment.content %></p>
              <% if comment.user == current_user %>
                <%= button_to "削除", post_comment_path(@post, comment), method: :delete, class: "btn btn-danger btn-sm", data: { confirm: "本当に削除しますか？" } %>
              <% end %>
            </div>
          </div>
        <% end %>

        <!-- コメントフォーム -->
        <%= form_with(model: [@post, @post.comments.build], local: true) do |form| %>
          <div class="mb-3">
            <%= form.label :content, 'コメント', class: 'form-label' %>
            <%= form.text_area :content, class: 'form-control', rows: 3 %>
          </div>
          <%= form.submit 'コメントを投稿', class: 'btn btn-primary' %>
        <% end %>
      </div>
    </div>
  </div>
</div>